<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sysevent_script_action">
    <sysevent_script_action action="INSERT_OR_UPDATE">
        <active>false</active>
        <condition_script/>
        <description/>
        <event_name>system.upgraded</event_name>
        <name>Migrate clear value actions</name>
        <order>100</order>
        <script><![CDATA[var scriptPrefix = "fix_migrate_clear_value_actions";

gs.info(scriptPrefix + "Started executing the script");
moveClearValueData();
gs.info(scriptPrefix + "Ended executing the script");

function moveClearValueData() {
    var clearValueTypes = ['25', '33'];
    var variableIds = [];
    var clearValueVariableIds = [];
    var gr1 = new GlideRecord("catalog_ui_policy_action");
    gr1.setWorkflow(false);
    gr1.get("cleared", true);
    while (gr1.next())
        variableIds.push(gr1.getValue("catalog_variable").substring(3));

    var variable = new GlideRecord("item_option_new");
    variable.addQuery("sys_id", variableIds);
    variable.addQuery("type", clearValueTypes);
    variable.setWorkflow(false);
    variable.query();
    while (variable.next())
        clearValueVariableIds.push("IO:" + variable.getUniqueValue());

    var gr = new GlideRecord("catalog_ui_policy_action");
    gr.addQuery("cleared", true);
    gr.addQuery("catalog_variable", "NOT IN", clearValueVariableIds);
    gr.setWorkflow(false);
    gr.setValue("value_action", "clear_value");
    gr.setValue("cleared", "");
    gr.setWorkflow(false);
	// Skip updating the version field
    GlideTransaction.get().setAttribute("catalog_wizard_origin", "default");
    gr.updateMultiple();
}

//Deactivate the script action after first run
var action = new GlideRecord("sysevent_script_action");
if (action.get("34878d54777131101a80bebc9f5a9961")) {
	action.setValue("active", false);
	action.update();
}
]]></script>
        <synchronous>false</synchronous>
        <sys_class_name>sysevent_script_action</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-10-06 08:11:40</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_domain_path/>
        <sys_id>34878d54777131101a80bebc9f5a9961</sys_id>
        <sys_mod_count>4</sys_mod_count>
        <sys_name>Migrate clear value actions</sys_name>
        <sys_overrides/>
        <sys_package display_value="UI Policy Rules for Service Catalog" source="com.glide.ui_policy_catalog">28241b30d0c322105590fd9a5a77e759</sys_package>
        <sys_policy/>
        <sys_scope display_value="Global Customizations - Upgrade Plan">f90ff3ea47ecb2105dc6f19f016d43cb</sys_scope>
        <sys_update_name>sysevent_script_action_34878d54777131101a80bebc9f5a9961</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-16 02:31:58</sys_updated_on>
    </sysevent_script_action>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Global Customizations - Upgrade Plan">f90ff3ea47ecb2105dc6f19f016d43cb</claim_owner_scope>
        <claim_timestamp>199eadc20fe0000001</claim_timestamp>
        <metadata_update_name>sysevent_script_action_34878d54777131101a80bebc9f5a9961</metadata_update_name>
        <previous_claim_app_version>1.0.0</previous_claim_app_version>
        <previous_claim_name>Global Customizations - Upgrade Plan</previous_claim_name>
        <previous_claim_scope>f90ff3ea47ecb2105dc6f19f016d43cb</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-10-16 02:31:58</sys_created_on>
        <sys_id>671f7fea47ecb2105dc6f19f016d4359</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-16 02:31:58</sys_updated_on>
    </sys_claim>
    <sys_claim action="INSERT_OR_UPDATE">
        <claim_owner_scope display_value="Global Customizations - Upgrade Plan">f90ff3ea47ecb2105dc6f19f016d43cb</claim_owner_scope>
        <claim_timestamp>199eadc20fd0000001</claim_timestamp>
        <metadata_update_name>sysevent_script_action_34878d54777131101a80bebc9f5a9961</metadata_update_name>
        <previous_claim_app_version/>
        <previous_claim_name>com.glide.ui_policy_catalog</previous_claim_name>
        <previous_claim_scope>com.glide.ui_policy_catalog</previous_claim_scope>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-10-16 02:31:58</sys_created_on>
        <sys_id>2b1f7fea47ecb2105dc6f19f016d4359</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-10-16 02:31:58</sys_updated_on>
    </sys_claim>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>34878d54777131101a80bebc9f5a9961</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2024-11-21 07:17:44</sys_created_on>
        <sys_id>b97d6af077c21210bec528e47a5a9997</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2024-11-21 07:17:44</sys_updated_on>
        <table>sysevent_script_action</table>
        <use_es_latest>false</use_es_latest>
    </sys_es_latest_script>
</record_update>
